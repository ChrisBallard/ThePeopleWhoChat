<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>TPWC</title>
    <script type="text/javascript" src="Scripts/jquery-1.9.1.min.js"></script>
    <script type="text/javascript">
        if (sessionStorage.token == null) {
            window.location.href = "Login.htm";
        }
    </script>
</head>
<body>
    <h2>TPWC</h2>
    <h4>Here are the people who chat...</h4>
    <button id="logout" onclick="logout()" >Logout</button>
    <hr />

    <button id="listrooms" onclick="listrooms()" >List Rooms</button>
    <span id="results" />


    <script type="text/javascript">
        function listrooms() {
            $.ajax({
                type: "GET",
                url: "/Chat.svc/rooms",
                headers: { 'Session-Token': sessionStorage.token }
            }).done(function (data) {
                $("#results").html(data.map(function (room) {
                    return "<br/>" + room.m_Item1 + " " + room.m_Item2['name@'];
                }));
            }).fail(function () {
                $("#results").html('failed');
            });

        }
        function logout() {
            $.ajax({
                type: "DELETE",
                url: "/Chat.svc/token/" + sessionStorage.token
            }).done(function () {
                sessionStorage.setItem('token', null);
                window.location.href = "/Login.htm";
            }).fail(function (x, msg) { $("#results").val("logout failed: " + msg); });
        }
    </script>
  </body>
</html>
